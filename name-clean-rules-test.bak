#lang racket
(require rackunit "name-clean-rules.rkt")

(define rules (get-rules test-file))

;(test-case
; "Check first rule is as expected"
; (check-eq? (caar rules) 'allow)
; (check-equal? (cdar rules) #rx"Season|season"))


(test-case 
 "Check all rules provides correct types"
 (for-each (lambda (x) (check-pred symbol? (car x))) rules)
 (for-each (lambda (x) (check-pred regexp? (cdr x))) rules))

(define white-list
  (list
   "Season"
   "McStroke"
   "MacDonalds"
   "DeLorean"))

(define black-list
  (list
   "[test]"
   "XviD"
   "TotALLy mAD"
   "[2009]"
   "2009"))

(define real-names-bad
  (list
   "Wall-E 2009 XviD"
   "Zombieland.XviD.Blu.Ray"
   "Family Guy [2009]"
   "Kiss.Kiss.Bang.Bang.2009.XviD.(cool)"
   "Dexter 1x01"
   "Arrested Development [2.03]"
   "Family Guy [8x10] McStroke"
   "Family Guy [8.10] McStroke HD"
   "Family Guy [8.10] McStroke HD XviD"
   "District9-720p"
   "spooks [1x01]"
   "Bridesmaids.2011.BRRip.XviD.Ac3.Feel-Free"
   "Pirates of the Caribbean On Stranger Tides (2011) DVDRip XviD-MAXSPEED www.torentz.3xforum.ro"))

(define real-names-good
  (list
   "Wall-E"
   "Zombieland"
   "Family Guy"
   "Kiss Kiss Bang Bang"
   "Dexter S01E01"
   "Arrested Development S02E03"
   "Family Guy S08E10 McStroke"
   "Family Guy S08E10 McStroke"
   "Family Guy S08E10 McStroke"
   "District9"
   "Spooks S01E01"
   "Bridesmaids"
   "Pirates of the Caribbean On Stranger Tides"))

(test-case
 "White-list: all should be allowed"
 (for-each check-equal? 
           (map (lambda (x) (apply-rules x rules)) white-list) 
           white-list))

(test-case
 "Black-list: all should be deleted"
 (for-each check-equal? 
           (map (lambda (x) (apply-rules x rules)) black-list) 
           (map (lambda (x) "") black-list)))

(check-equal? (apply-rules "Piers Morgan" rules) "Pillock")

(test-case
 "Real names test"
 (map check-equal? 
      (map (lambda (x) (apply-rules x rules)) real-names-bad) 
      real-names-good))